<!DOCTYPE html>
<html>
<head>
  <title>Ger√ßek Optik Okuyucu</title>
  <script async src="https://docs.opencv.org/4.5.2/opencv.js" onload="onOpenCvReady();"></script>
  <style>
    body { font-family: Arial; text-align: center; }
    video, canvas { border: 1px solid #ccc; margin: 10px; }
    #results { font-size: 18px; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Ger√ßek Optik Okuyucu</h1>
  <video id="video" width="640" height="480" autoplay></video><br>
  <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>
  <button onclick="analyzeFrame()">üì∑ Okut</button>
  <div id="results">Sonu√ß burada g√∂r√ºnecek...</div>

  <script>
    const answerKey = ["B", "C", "A", "D", "E", "C", "A", "B", "D", "E"];
    const shiklar = [];
    const baseX = 100, baseY = 50, stepY = 35, stepX = 30;

    for (let i = 0; i < 10; i++) {
      for (let j = 0; j < 5; j++) {
        shiklar.push({
          soru: i,
          secenek: String.fromCharCode(65 + j),
          x: baseX + j * stepX,
          y: baseY + i * stepY,
          w: 20,
          h: 20
        });
      }
    }

    let video = document.getElementById("video");
    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");

    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => video.srcObject = stream)
      .catch(err => alert("Kamera a√ßƒ±lamadƒ±: " + err));

    function onOpenCvReady() {
      console.log("OpenCV y√ºklendi");
    }

    function analyzeFrame() {
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      let src = cv.imread(canvas);
      let gray = new cv.Mat();
      cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY);
      let threshold = new cv.Mat();
      cv.threshold(gray, threshold, 127, 255, cv.THRESH_BINARY_INV);

      const kullaniciCevaplar = [];
      for (let i = 0; i < 10; i++) {
        let maxFill = 0;
        let secenek = "";
        for (let j = 0; j < 5; j++) {
          let s = shiklar[i * 5 + j];
          let roi = threshold.roi(new cv.Rect(s.x, s.y, s.w, s.h));
          let nonZero = cv.countNonZero(roi);
          if (nonZero > maxFill && nonZero > 30) {
            maxFill = nonZero;
            secenek = s.secenek;
          }
          roi.delete();
        }
        kullaniciCevaplar.push(secenek);
      }

      let dogru = 0, yanlis = 0, bos = 0;
      for (let i = 0; i < answerKey.length; i++) {
        let k = kullaniciCevaplar[i];
        let d = answerKey[i];
        if (!k) bos++;
        else if (k === d) dogru++;
        else yanlis++;
      }
      let net = dogru - yanlis / 4;
      document.getElementById("results").innerHTML = `
        ‚úÖ Doƒüru: ${dogru}<br>
        ‚ùå Yanlƒ±≈ü: ${yanlis}<br>
        ‚≠ï Bo≈ü: ${bos}<br>
        üìä Net: ${net.toFixed(2)}<br>
        üîé Cevaplar: ${kullaniciCevaplar.join(" ")}
      `;

      src.delete(); gray.delete(); threshold.delete();
    }
  </script>
</body>
</html>
